<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invent√°rio RT Web</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="/styles.css"> 
</head>
<body>

    <div class="dashboard-container">

<!-- 
‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤
                NAVBAR
‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº
-->
        <nav class="navbar-top">
            <div style="display: flex; align-items: center;">
                <button class="btn" style="background: none; color: white;" id="sidebarToggle" aria-label="Toggle menu">
                </button>
                <div class="logo-text">
                    <img src="/assets/images/logo-negativo.svg" alt="logo R.T. WEB"> 
                </div>
            </div>
            <div>
                <button class="btn" style="background: none; color: white;" aria-label="Notifica√ß√µes">
                    <img src="/assets/images/bell.svg" alt="Notifica√ß√µes">
                </button>
                <button class="btn" style="background: none; color: white;" aria-label="Notifica√ß√µes">
                    <img src="/assets/images/menu.svg" alt="Menu">
                </button>
            </div>
        </nav>
<!-- 
‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤
                Sidebar
‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº
-->

        <aside class="sidebar" id="sidebarMenu">
            <nav>
                <ul class="sidebar-menu pt-4"> 
                    <li>
                        <a href="#">
                            <i class="fas fa-tachometer-alt"></i> <span class="link-text">Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="fas fa-box-open"></i> <span class="link-text">Gest√£o do estoque</span>
                        </a>
                    </li>
                    <li>
                        <a class="active" aria-current="page" href="#">
                            <i class="fas fa-warehouse"></i> <span class="link-text">Invent√°rio</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="fas fa-history"></i> <span class="link-text">Hist√≥rico</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="fas fa-bell"></i> <span class="link-text">Notifica√ß√µes</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="fas fa-cog"></i> <span class="link-text">Configura√ß√µes</span>
                        </a>
                    </li>
                </ul>
            </nav>
            
            <div class="sidebar-footer">
                <a class="sidebar-menu-item" href="#" style="display: flex; justify-content: center; text-decoration: none;">
                    <i class="fas fa-sign-out-alt"></i> <span class="link-text" style="margin-left: 10px; color: var(--secondary-text-color);">Sair</span>
                </a>
            </div>
        </aside>

<!-- 
‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤
                Main
‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº
-->

        <main class="main-content" id="mainContent">

<!-- 
‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤
              Breadcrumb
‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº
-->

            <div class="bread-crumb"> 
                <button class="btn" style="background: none;" aria-label="Notifica√ß√µes">
                    <img src="/assets/images/back.svg" alt="Voltar para p√°gina anterior">
                </button>
                
                <h1>Invent√°rio</h1>

                </button>
            </div>

<!-- 
‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤
              Filtros
‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº
-->


            <div class="filter-row">
                <form method="GET" action="/">
                    
                        <input 
                            class="input-group"
                            type="text" 
                            placeholder= "Procure pelo nome ou identificador "
                            name="busca"
                            value="<%= termoBusca %>"
                        >
                    
                    <button class="btn btn-primary" type="submit">Buscar</button>
                </form>
            </div>

<!-- 
‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤
        Tabela (Miolo da p√°gina)
‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº
-->            

            <div class="card">
                <div style="overflow-x: auto;">
                    <table class='table-inventory'>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Produto</th>
                                <th>Unidade</th>
                                <th>Estoque</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% produtos.forEach(produto => { %>
                                <tr id="row-<%= produto.id_produto %>">
                                    <td><%= String(produto.id_produto).padStart(4, '0') %></td>
                                    <td><%= produto.nome_produto %></td>
                                    <td><%= produto.tipo_unidade %></td>
                                    <td id="quant-<%= produto.id_produto %>"><%= produto.quant_estoque %></td>
                                    <td>
                                        <button class="btn btn-filled" onclick="openEditModal(<%= produto.id_produto %>, '<%= produto.nome_produto %>', <%= produto.quant_estoque %>)">
                                            Editar <i class='fas fa-chevron-right'></i>
                                        </button>
                                        <button class="btn btn-icon" onclick="excluirProduto(<%= produto.id_produto %>, '<%= produto.nome_produto %>')">
                                            <i class='far fa-trash-alt'></i>
                                        </button>
                                    </td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            </div>

<!-- 
‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤
                Footer
‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº
-->

            <div class="action-footer">
                <!-- <button class="btn btn-link">Excluir item</button> -->
                <button class="btn btn-primary" onclick="openModal('addProdutoModal')"> 
                    Novo item <i class='fas fa-plus'></i>
                </button>
            </div>
        </main>
    </div>

<!-- 
‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤
              Modais
‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº
-->

    <div id="addProdutoModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('addProdutoModal')">&times;</span>
            <h3>Adicionar novo Item</h3>
            <form id="addProdutoForm"  class="form-collun">
                <div class="filter-collunm">
                    <label for="nome" class="form-label">Nome:</label>
                    <input type="text" class="input-group" id="nome" name="nome" required>
                </div>
                <div class="filter-collunm">
                    <label for="unidade" class="form-label">Unidade de medida:</label>
                    <input type="text" class="input-group" id="unidade" name="unidade" required>
                </div>
                <div class="filter-collunm">
                    <label for="quantidade" class="form-label">Quantidade Inicial de Entrada:</label>
                    <input type="number" class="input-group" id="quantidade" name="quantidade" min="1" required>
                </div>
                <button type="submit" class="btn btn-primary">Salvar</button>
            </form>
        </div>
    </div>

    <div id="editProdutoModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('editProdutoModal')">&times;</span>
             <h3 id="editModalTitle">Movimentar Estoque</h3> <!-- aqui vai o nome do produto no modal -->
            <p>Estoque atual: <strong id="estoqueAtualDisplay"></strong></p>
            <form id="editProdutoForm">
                <input type="hidden" class="input-group" id="edit_id_produto" name="id_produto">
                
                <div class="filter-collunm">
                    <label for="edit_quantidade" class="form-label">Quantidade a Movimentar:</label>
                    <input type="number" class="input-group" id="edit_quantidade" name="quantidade" min="1" required>
                </div>
                <div class="filter-collunm">
                    <label for="tipo_movimentacao" class="form-label">Tipo de Movimenta√ß√£o:</label>
                    <select class="form-select" id="tipo_movimentacao" name="tipo_movimentacao" required>
                        <option value="entrada">Entrada (Adicionar)</option>
                        <option value="saida">Sa√≠da (Remover)</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-primary">Registrar movimenta√ß√£o</button>
            </form>
        </div>
    </div>

<!-- 
‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤
              Scrips
‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº
-->

    <script src="/js/main.js"></script> 
    
    <script>
        // L√≥gica para toggle da Sidebar
        document.getElementById('sidebarToggle').addEventListener('click', function() {
            const body = document.body;
            body.classList.toggle('sidebar-collapsed');
        });

        // --- FUN√á√ïES DE MODAL ---

        /** Abre um modal espec√≠fico */
        function openModal(modalId) {
            // Certifique-se de que a div 'modal' tem 'display: none' no CSS inicial
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'flex'; // Usar 'flex' para centralizar melhor o conte√∫do
            }
        }

        /** Fecha um modal espec√≠fico */
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
        }

        /** Prepara e abre o modal de edi√ß√£o/movimenta√ß√£o.
         * @param {number} id - ID do produto.
         * @param {string} nome - Nome do produto.
         * @param {number} estoque - Estoque atual do produto.
         */
        function openEditModal(id, nome, estoque) {
            document.getElementById('editModalTitle').innerText = `${nome}`; // aqui vai o nome do produto no modal
            document.getElementById('edit_id_produto').value = id;
            document.getElementById('estoqueAtualDisplay').innerText = estoque;
            document.getElementById('edit_quantidade').value = 1; 
            openModal('editProdutoModal');
        }

        // --- FUN√á√ïES DE INTERA√á√ÉO COM O BACKEND (AJAX/Fetch) ---

/* 
‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤
            Atualiza p√°gina
‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº
*/
        async function atualizarEstoqueProduto() {
            try {
                // Refaz a requisi√ß√£o GET para a rota principal
                const fullResponse = await fetch('/');
                const htmlText = await fullResponse.text();

                // Cria um elemento tempor√°rio para parsear o HTML
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = htmlText;
                
                // Encontra o novo corpo da tabela (usando a classe 'table-inventory')
                const newTbody = tempDiv.querySelector('.table-inventory tbody');
                
                // Encontra o corpo da tabela atual
                const currentTbody = document.querySelector('.table-inventory tbody');
                
                // Substitui o corpo da tabela atual pelo novo corpo
                if (currentTbody && newTbody) {
                    currentTbody.parentNode.replaceChild(newTbody, currentTbody);
                }

            } catch (error) {
                console.error('Erro ao buscar estoque atualizado:', error);
                alert('Erro ao atualizar a lista de estoque. Recarregue a p√°gina.');
            }
        }


/* 
‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤
            Adicionar novo produto
‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº
*/        
        document.getElementById('addProdutoForm').addEventListener('submit', async function(event) {
            event.preventDefault(); 
            
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());

            try {
                const response = await fetch('/produtos', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('üéâ Produto adicionado com sucesso!');
                    closeModal('addProdutoModal');
                    // Atualiza a tabela dinamicamente
                    await atualizarEstoqueProduto(); 
                } else {
                    alert('‚ùå Erro: ' + result.message);
                }
            } catch (error) {
                console.error('Erro de rede/servidor:', error);
                alert('Erro ao comunicar com o servidor.');
            }
        });

/* 
‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤
                 Movimentacao 
        Adicioar ou remover produtos
‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº
*/
        document.getElementById('editProdutoForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());

            try {
                const response = await fetch('/movimentacoes', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('üì¶ Movimenta√ß√£o registrada!');
                    closeModal('editProdutoModal');
                    // Atualiza a tabela dinamicamente
                    await atualizarEstoqueProduto(); 
                } else {
                    alert('‚ùå Erro: ' + result.message);
                }
            } catch (error) {
                console.error('Erro de rede/servidor:', error);
                alert('Erro ao comunicar com o servidor.');
            }
        });


/* 
‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤
            Exclui produtos
‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº
*/
        async function excluirProduto(id, nome) {
            if (!confirm(`Tem certeza que deseja EXCLUIR o produto "${nome}" (ID: ${id}) e todas as suas movimenta√ß√µes?`)) {
                return; 
            }

            try {
                const response = await fetch(`/produtos/${id}`, {
                    method: 'DELETE'
                });

                const result = await response.json();
                
                if (result.success) {
                    alert(`üóëÔ∏è Produto exclu√≠do: ${nome}`);
                    // Remove a linha da tabela dinamicamente
                    const rowToRemove = document.getElementById(`row-${id}`);
                    if (rowToRemove) {
                        rowToRemove.remove();
                    }
                } else {
                    alert('‚ùå Erro: ' + result.message);
                }
            } catch (error) {
                console.error('Erro ao excluir produto:', error);
                alert('Erro ao tentar excluir o produto.');
            }
        }
    </script>
</body>
</html>